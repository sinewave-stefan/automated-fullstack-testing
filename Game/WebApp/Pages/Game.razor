@page "/game"
@using global::Game.Core

<PageTitle>Game Demo</PageTitle>

<h1>Game Demo - Shared Core Logic</h1>

<div class="game-container">
    <div class="info-panel">
        <h3>Player Status</h3>
        <p><strong>Name:</strong> @player.Name</p>
        <p><strong>Health:</strong> @player.Health / @player.MaxHealth</p>
        <p><strong>Position:</strong> (@player.Position.X.ToString("F1"), @player.Position.Y.ToString("F1"))</p>
        <p><strong>Status:</strong> @(player.IsAlive ? "Alive" : "Dead")</p>
    </div>

    <div class="controls">
        <h3>Controls</h3>
        <button class="btn btn-primary" @onclick="MoveUp">‚Üë Move Up</button>
        <button class="btn btn-primary" @onclick="MoveDown">‚Üì Move Down</button>
        <button class="btn btn-primary" @onclick="MoveLeft">‚Üê Move Left</button>
        <button class="btn btn-primary" @onclick="MoveRight">‚Üí Move Right</button>
        <br />
        <button class="btn btn-danger" @onclick="TakeDamage">üí• Take Damage (10)</button>
        <button class="btn btn-success" @onclick="Heal">‚ù§Ô∏è Heal (20)</button>
    </div>

    <div class="ai-demo">
        <h3>AI Demo</h3>
        <p><strong>AI Decision:</strong> @currentDecision</p>
        <p><strong>Distance to Player:</strong> @distanceToPlayer.ToString("F1")</p>
        <button class="btn btn-info" @onclick="UpdateAI">ü§ñ Update AI</button>
        <button class="btn btn-secondary" @onclick="GeneratePatrol">üö∂ Generate Patrol Point</button>
        <p><strong>Patrol Point:</strong> (@patrolPoint.X.ToString("F1"), @patrolPoint.Y.ToString("F1"))</p>
    </div>

    <div class="canvas-placeholder">
        <h3>Rendering Area</h3>
        <p>This is where WebGL rendering would occur.</p>
        <p>The rendering uses the same Core library logic as the native Stride build.</p>
        <svg width="400" height="300" style="border: 1px solid #ccc; background: #f9f9f9;">
            <circle cx="@(200 + player.Position.X * 10)" cy="@(150 + player.Position.Y * 10)" 
                    r="20" fill="@(player.IsAlive ? "blue" : "gray")" />
            <text x="@(200 + player.Position.X * 10)" y="@(150 + player.Position.Y * 10 - 30)" 
                  text-anchor="middle" font-size="12">Player</text>
            <circle cx="@(200 + patrolPoint.X * 10)" cy="@(150 + patrolPoint.Y * 10)" 
                    r="5" fill="green" />
        </svg>
    </div>
</div>

@code {
    private Player player = new Player("Web Player", 100);
    private AI ai = new AI(DateTime.Now.Millisecond);
    private AIDecision currentDecision = AIDecision.Seek;
    private Vector2D patrolPoint = new Vector2D(0, 0);
    private float distanceToPlayer = 0;

    private void MoveUp() => player.Move(0, -1);
    private void MoveDown() => player.Move(0, 1);
    private void MoveLeft() => player.Move(-1, 0);
    private void MoveRight() => player.Move(1, 0);

    private void TakeDamage()
    {
        player.TakeDamage(10);
    }

    private void Heal()
    {
        if (player.IsAlive)
        {
            player.Heal(20);
        }
    }

    private void UpdateAI()
    {
        distanceToPlayer = Vector2D.Distance(patrolPoint, player.Position);
        currentDecision = ai.MakeDecision(player.Health, player.MaxHealth, distanceToPlayer);
    }

    private void GeneratePatrol()
    {
        patrolPoint = ai.GeneratePatrolPoint(new Vector2D(0, 0), 15);
        UpdateAI();
    }

    protected override void OnInitialized()
    {
        GeneratePatrol();
    }
}

<style>
    .game-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }

    .info-panel, .controls, .ai-demo, .canvas-placeholder {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 5px;
        background: #fff;
    }

    .btn {
        margin: 5px;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-primary { background: #007bff; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-info { background: #17a2b8; color: white; }
    .btn-secondary { background: #6c757d; color: white; }

    .btn:hover {
        opacity: 0.9;
    }

    .canvas-placeholder {
        grid-column: 1 / -1;
        text-align: center;
    }
</style>
